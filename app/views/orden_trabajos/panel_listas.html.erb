<div class="container mt-4">
  <h3 class="text-center">üîÄ √ìrdenes de trabajo por Listas</h3>
  <div data-controller="buscar-ot">
    <div class="row align-items-end mt-3">
      <!-- Dropdown -->
      <div class="col-md-3">
        <%= form_with model: @orden_trabajo, url: orden_trabajos_path, local: true do |f| %>
          <div class="mb-3">
            <%= f.select :lista, @listas, {},
                  class: "form-select",
                  data: { buscar_ot_target: "lista" } %>
          </div>
        <% end %>
      </div>
      <!-- Buscador -->
      <div class="col-md-7">
        <div class="input-group mb-3">
          <input type="text"
                 class="form-control"
                 placeholder="Buscar N¬∞ OT o Cliente"
                 data-buscar-ot-target="input">

          <button class="btn btn-primary"
                  type="button"
                  data-action="click->buscar-ot#buscar">
            Buscar
          </button>
        </div>
      </div>
      <!-- Bot√≥n PDF -->
      <div class="col-md-2 d-flex justify-content-end mb-3">
        <%= link_to "üìÑ Descargar PDF",
                panel_listas_pdf_orden_trabajos_path(format: :pdf),
                class: "btn btn-success h-100",
                target: "_blank",
                rel: "noopener" %>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <div id="resultados_busqueda"
             data-buscar-ot-target="resultados">
        </div>
      </div>
    </div>
    <!-- ‚≠ê FILA 3: TABLAS DE LISTAS (Aqu√≠ va tu bloque) -->
    <div class="p-2 border rounded shadow-sm">
      <div class="col-12">
        <% OrdenTrabajo::LIST.each do |lista| %>
          <h3 class="text-center mb-2 bg-primary text-white rounded"><%= lista %></h3>
          <table class="table table-striped table-hover text-center align-middle">
            <thead class="table-dark">
              <tr>
                <th>Posici√≥n</th>
                <th>N¬∞ OT</th>
                <th>Cliente</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Papel</th>
                <th>Gramaje</th>
                <th>Color</th>
                <th></th>
              </tr>
            </thead>
            <tbody
              id="tabla_lista_<%= lista.parameterize(separator: '_') %>"
              data-controller="sortable"
              data-sortable-target="tbody"
              data-sortable-url-value="<%= ordenar_lista_orden_trabajos_path(lista: lista) %>"
            >
              <% @ordenes_por_lista[lista].to_a.each do |ot| %>
                <tr id="ot_<%= ot.id %>" data-id="<%= ot.id %>" draggable="true">
                  <td><%= ot.position %></td>
                  <td><%= ot.trnum %></td>
                  <td><%= ot.clinom %></td>
                  <td><%= ot.nomprod %></td>
                  <td><%= ot.trcan %></td>
                  <td><%= ot.papel %></td>
                  <td><%= ot.gramaje %></td>
                  <td><%= ot.colores %></td>
                  <td>
                    <%= button_to quitar_lista_orden_trabajo_path(ot),
                          method: :patch,
                          class: "btn btn-danger btn-sm",
                          form: { data: { turbo_stream: true } } do %>
                      ‚ùå Quitar
                    <% end %>
                  </td>
                </tr>
              <% end %>

            </tbody>

          </table>
        <% end %>
      </div>
    </div>
  </div>
</div>
