<div class="d-flex justify-content-around flex-wrap">
  <% ["en espera", "LISTO"].each do |estado| %>
    <div class="container col-md-6">
      <h1 class="mt-3 p-2 text-white text-center rounded <%= estado == "en espera" ? 'bg-danger' : 'bg-success' %>">
        <strong><%= proceso.upcase %> <%= estado %></strong>
      </h1>
      <table class="table table-striped table-bordered shadow-sm">
        <thead class="bg-info text-white">
          <tr>
            <th>Posición</th>
            <th>OT</th>
            <th>Cliente</th>
            <th>Producto</th>
            <th>Fecha Entrega</th>
          </tr>
        </thead>
        <tbody data-controller="reorderable"
       data-sortable-url-value="<%= reorder_orden_trabajos_path(proceso: proceso) %>"
       data-sortable-target="tbody">

          <% @orden_trabajos.each do |orden_trabajo| %>
            <% procesos = cadenatovector(orden_trabajo.procesos) %>
            <% if procesos.include?(proceso) %>
              <% if estado == "en espera" &&
                    !["Impresión", "Pendiente", "Terminación", "Empaque"].include?(orden_trabajo.estado_actual) %>
                <tr data-id="<%= orden_trabajo.id %>" draggable="true">
                  <td><%= orden_trabajo.position %></td>
                  <td class="
                    <%=
                      case orden_trabajo.priority
                      when 'Alta'  then 'bg-danger text-white'
                      when 'Media' then 'bg-warning'
                      else              'bg-success text-white'
                      end
                    %>">
                    <strong><%= orden_trabajo.trnum %></strong>
                  </td>

                  <td><%= orden_trabajo.clinom %></td>
                  <td><%= orden_trabajo.nomprod.first(25) %></td>
                  <td><%= orden_trabajo.deadline.try(:strftime, "%d-%m-%Y") %></td>
                </tr>
              <% elsif estado == "LISTO" && orden_trabajo.estado_actual&.match?(/Impresión|Terminación/i) %>
                <tr data-id="<%= orden_trabajo.id %>" draggable="true">
                  <td><%= orden_trabajo.trnum %></td>
                  <td><%= orden_trabajo.clinom %></td>
                  <td><%= orden_trabajo.nomprod.first(25) %></td>
                  <td><%= orden_trabajo.deadline.try(:strftime, "%d-%m-%Y") %></td>
                </tr>
              <% end %>

            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
