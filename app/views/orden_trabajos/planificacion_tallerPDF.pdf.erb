<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Planificación Taller</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 10pt;
      margin: 15px;
    }

    h1, h2, h3 {
      text-align: center;
      margin: 5px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }

    th, td {
      border: 1px solid #555;
      padding: 4px 6px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .section-title {
      background-color: #007bff;
      color: white;
      padding: 5px;
      text-transform: uppercase;
    }

    .ready {
      background-color: #28a745;
      color: white;
    }

    .waiting {
      background-color: #dc3545;
      color: white;
    }

    .divider {
      text-align: center;
      color: #888;
      margin: 10px 0;
    }

    .page-break {
      page-break-after: always;
    }
  </style>
</head>
<body>
<h1>Planificación Taller - <%= Date.today.strftime('%d/%m/%Y') %></h1>

<% grupos = {
  "SM" => "SM",
  "PM" => "PM",
  "GTO" => "GTO",
  "Ko" => "KO",
  "Xe" => "XE",
  "SORZ" => "SORZ",
  "Tipografia" => "Tipografía",
  "Binder" => "Binder",
  "Duplo" => "Duplo",
  "Lam" => "Laminadora",
  "Zechini" => "Zechini",
  "Baum" => "Baum",
  "Fidia" => "Fidia",
  "Buv" => "Buv",
  "Renz" => "Renz"
} %>

<% grupos.each do |clave, nombre| %>
  <div class="section">
    <h2 class="section-title"><%= nombre %></h2>

    <div class="waiting">
      <h3><%= nombre %> en espera</h3>
    </div>

    <table>
      <thead>
        <tr>
          <th>OT</th>
          <th>Cliente</th>
          <th>Producto</th>
        </tr>
      </thead>
      <tbody>
        <% @orden_trabajos.each do |orden_trabajo| %>
          <% if cadenatovector(orden_trabajo.procesos).include?(clave) &&
                !["Impresión", "Pendiente", "Terminación", "Empaque"].include?(orden_trabajo.estado_actual) %>
            <tr>
              <td><%= orden_trabajo.trnum %></td>
              <td><%= orden_trabajo.clinom %></td>
              <td><%= orden_trabajo.nomprod.first(25) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>

    <div class="ready">
      <h3><%= nombre %> listo</h3>
    </div>

    <table>
      <thead>
        <tr>
          <th>OT</th>
          <th>Cliente</th>
          <th>Producto</th>
        </tr>
      </thead>
      <tbody>
        <% @orden_trabajos.each do |orden_trabajo| %>
          <% if cadenatovector(orden_trabajo.procesos).include?(clave) &&
      orden_trabajo.estado_actual&.include?("Impresión") %>

            <tr>
              <td><%= orden_trabajo.trnum %></td>
              <td><%= orden_trabajo.clinom %></td>
              <td><%= orden_trabajo.nomprod.first(25) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>

    <div class="divider">──────────────────────────────────────────────</div>
  </div>

  <div class="page-break"></div>
<% end %>
</body>
</html>
